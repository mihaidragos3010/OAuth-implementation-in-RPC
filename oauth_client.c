/*
 * This is sample code generated by rpcgen.
 * These are only templates and you can use them
 * as a guideline for developing your own functions.
 */

#include "oauth.h"
#include "library/client/utils.h"

void oauth_prog_1(char *host, char* idClient){

	CLIENT *clnt;

	clnt = clnt_create (host, OAUTH_PROG, OAUTH_VERS, "udp");
	if (clnt == NULL) {
		clnt_pcreateerror (host);
		exit (1);
	}

	ResponseAuthToken  *response_auth_token = request_auth_token_1(&idClient, clnt);
	printf("%s\n\n", response_auth_token->auth_token);

	ResponseSignedToken  *response_signed_token = request_signed_token_1(&response_auth_token->auth_token, clnt);
	// printf("%s\n\n", response_signed_token->signed_token);

	ResponseBearerToken  *response_bearer_token = request_bearer_token_1(&response_signed_token->signed_token, clnt);
	// printf("%s\n\n", response_bearer_token->access_token);
	clnt_destroy (clnt);
}


int main (int argc, char *argv[]){

	if (argc < 3) {
		printf ("Client need host and input file as arguments!!");
		exit (1);
	}
	
	char* host = argv[1];
	char* file = argv[2];

	InputClient* inputClients;
	int nrInputs = readInputClientFile(file, &inputClients);

	for(int i=0; i<nrInputs; i++){

		InputClient input = inputClients[i];

		if(strcmp(input.command, "REQUEST") == 0){

			oauth_prog_1(host, input.id);
		}

		// if(strchr(input.command, "READ") == 0){
		// 	oauth_prog_1 (host);
		// }

		// if(strchr(input.command, "MODIFY") == 0){
		// 	oauth_prog_1 (host);
		// }

		// if(strchr(input.command, "INSERT") == 0){
		// 	oauth_prog_1 (host);
		// }

		// if(strchr(input.command, "EXECUTE") == 0){
		// 	oauth_prog_1 (host);
		// }

		// if(strchr(input.command, "DELETE") == 0){
		// 	oauth_prog_1 (host);
		// }

	}

exit (0);
}
